<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaySwap</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase 관련 메타 태그 추가 -->
    <link rel="manifest" href="/manifest.json">
</head>
<body>
<header class="header">
    <div class="container">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="fas fa-home"></i>
                <span>StaySwap</span>
            </a>
            <nav class="main-nav">
                <a href="/page/listings" class="nav-link">숙소 찾기</a>
                <a href="/page/new" class="nav-link">숙소 등록</a>
                <a href="/page/exchanges" class="nav-link">교환 관리</a>
            </nav>
            <div class="user-actions">
                <div id="user-profile" style="display: none;">
                    <a href="/page/profile" class="avatar-link">
                        <div class="avatar">
                            <img id="profile-image" src="/placeholder.svg" alt="프로필">
                            <span id="profile-initial">사</span>
                        </div>
                    </a>
                </div>
                <div id="auth-buttons">
                    <a href="/page/auth" class="btn btn-outline">로그인</a>
<!--                    <a href="/auth?tab=register" class="btn btn-primary">회원가입</a>-->
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    <!-- 각 페이지의 내용이 여기에 들어갑니다 -->
</main>

<!--<footer class="footer">-->
<!--    <div class="container">-->
<!--        <div class="footer-content">-->
<!--            <div class="copyright">© 2025 StaySwap. All rights reserved.</div>-->
<!--            <div class="footer-links">-->
<!--                <a href="#" class="footer-link">이용약관</a>-->
<!--                <a href="#" class="footer-link">개인정보처리방침</a>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</footer>-->

<!-- Firebase SDK 추가 -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>

<!-- Firebase 초기화 스크립트 -->
<script th:inline="javascript">
    // 서버에서 전달받은 Firebase 설정
    const firebaseConfig = {
        apiKey: /*[[${firebaseConfig.apiKey}]]*/ '',
        authDomain: /*[[${firebaseConfig.authDomain}]]*/ '',
        projectId: /*[[${firebaseConfig.projectId}]]*/ '',
        storageBucket: /*[[${firebaseConfig.storageBucket}]]*/ '',
        messagingSenderId: /*[[${firebaseConfig.messagingSenderId}]]*/ '',
        appId: /*[[${firebaseConfig.appId}]]*/ '',
        measurementId: /*[[${firebaseConfig.measurementId}]]*/ ''
    };
    
    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    
    // FCM 토큰 발급에 사용할 VAPID 키 전역 변수로 설정
    window.vapidKey = /*[[${firebaseConfig.vapidKey}]]*/ '';
</script>

<script th:src="@{/js/main.js}"></script>
<script th:src="@{/js/fcm-token.js}"></script>
<script>
    // 사용자 인증 상태에 따라 UI 업데이트
    function updateAuthUI(user) {
        const userProfile = document.getElementById('user-profile');
        const authButtons = document.getElementById('auth-buttons');
        const profileImage = document.getElementById('profile-image');
        const profileInitial = document.getElementById('profile-initial');

        if (user) {
            userProfile.style.display = 'block';
            authButtons.style.display = 'none';

            if (user.profileImage) {
                profileImage.src = user.profileImage;
                profileImage.style.display = 'block';
                profileInitial.style.display = 'none';
            } else {
                profileImage.style.display = 'none';
                profileInitial.style.display = 'block';
                profileInitial.textContent = user.name.charAt(0);
            }
            
            // 사용자가 로그인한 경우 FCM 토큰 초기화
            initFCM();
        } else {
            userProfile.style.display = 'none';
            authButtons.style.display = 'flex';
        }
    }

    // API에서 사용자 정보 가져오기
    function fetchUserInfo() {
        // 실제 구현 시 API 호출
        // fetch('/api/user')
        //     .then(response => response.json())
        //     .then(user => updateAuthUI(user))
        //     .catch(() => updateAuthUI(null));

        // 테스트용 더미 데이터
        const user = null; // 로그인 안 된 상태
        // const user = { name: '홍길동', profileImage: null }; // 로그인 된 상태
        updateAuthUI(user);
    }

    // 페이지 로드 시 사용자 정보 가져오기
    document.addEventListener('DOMContentLoaded', fetchUserInfo);
</script>
</body>
</html>