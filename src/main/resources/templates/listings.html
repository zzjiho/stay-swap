<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숙소 탐색 - StaySwap</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/listings.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div th:replace="~{layout/layout :: header}"></div>

<main>
    <section class="listings-section">
        <div class="container">
            <div class="listings-header">
                <h1 class="listings-title">숙소 탐색</h1>
                <div class="view-toggle">
                    <div class="toggle-buttons">
                        <button class="toggle-button active" data-view="list">
                            <i class="fas fa-list"></i>
                            목록
                        </button>
                        <button class="toggle-button" data-view="map">
                            <i class="fas fa-map-marker-alt"></i>
                            지도
                        </button>
                    </div>
                </div>
            </div>

            <div class="search-bar">
                <div class="search-input">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-query" placeholder="지역, 도시 또는 주소 검색" class="form-input">
                </div>
                <div class="search-filters">
                    <button class="btn btn-outline btn-filter" id="date-filter">
                        <i class="fas fa-calendar"></i>
                        날짜
                    </button>
                    <button class="btn btn-outline btn-filter" id="more-filters">
                        <i class="fas fa-filter"></i>
                        필터
                    </button>
                </div>
            </div>

            <div class="listings-content">
                <div class="view-pane active" id="list-view">
                    <div class="listings-grid" id="listings-container">
                        <!-- 숙소 카드는 JavaScript로 동적 생성됩니다   id="listings-container">
                        <!-- 숙소 카드는 JavaScript로 동적 생성됩니다 -->
                    </div>
                </div>

                <div class="view-pane" id="map-view">
                    <div class="map-container">
                        <div class="map-placeholder">
                            <i class="fas fa-map-marked-alt"></i>
                            <h3>지도 뷰</h3>
                            <p>지도에서 숙소 위치를 확인하세요</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<div th:replace="~{layout/footer :: footer}"></div>
<script th:src="@{/js/main.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 숙소 데이터 가져오기
        fetchListings();

        // 검색 기능
        const searchInput = document.getElementById('search-query');
        searchInput.addEventListener('input', debounce(function() {
            fetchListings(searchInput.value);
        }, 500));

        // 필터 버튼 이벤트
        document.getElementById('date-filter').addEventListener('click', function() {
            alert('날짜 필터 기능은 준비 중입니다.');
        });

        document.getElementById('more-filters').addEventListener('click', function() {
            alert('추가 필터 기능은 준비 중입니다.');
        });
    });

    // API에서 숙소 목록 가져오기
    function fetchListings(query = '') {
        // 실제 구현 시 API 호출
        // fetch(`/api/listings?query=${encodeURIComponent(query)}`)
        //     .then(response => response.json())
        //     .then(data => renderListings(data))
        //     .catch(error => {
        //         console.error('Error:', error);
        //         alert('숙소 목록을 불러오는 중 오류가 발생했습니다.');
        //     });

        // 테스트용 더미 데이터
        const dummyListings = [
            {
                id: 1,
                title: '서울 강남 모던 아파트',
                image: '/images/listing1.jpg',
                location: '서울 강남구',
                rating: 4.9,
                features: ['LiveLocal', 'TimeBank'],
                points: 500,
                host: {
                    name: '김민수',
                    image: '/images/host1.jpg'
                }
            },
            {
                id: 2,
                title: '제주 바다 전망 빌라',
                image: '/images/listing2.jpg',
                location: '제주 서귀포시',
                rating: 4.8,
                features: ['LiveLocal'],
                points: 700,
                host: {
                    name: '이지은',
                    image: '/images/host2.jpg'
                }
            },
            {
                id: 3,
                title: '부산 해운대 오션뷰 콘도',
                image: '/images/listing3.jpg',
                location: '부산 해운대구',
                rating: 4.7,
                features: ['TimeBank'],
                points: 600,
                host: {
                    name: '박준호',
                    image: '/images/host3.jpg'
                }
            }
        ];

        // 검색어가 있으면 필터링
        const filteredListings = query
            ? dummyListings.filter(listing =>
                listing.title.includes(query) ||
                listing.location.includes(query)
            )
            : dummyListings;

        renderListings(filteredListings);
    }

    // 숙소 목록 렌더링
    function renderListings(listings) {
        const container = document.getElementById('listings-container');
        container.innerHTML = '';

        if (listings.length === 0) {
            container.innerHTML = '<div class="no-results">검색 결과가 없습니다.</div>';
            return;
        }

        listings.forEach(listing => {
            const card = document.createElement('div');
            card.className = 'listing-card';

            card.innerHTML = `
                    <a href="/listings/${listing.id}" class="listing-link">
                        <div class="listing-image">
                            <img src="${listing.image}" alt="${listing.title}">
                        </div>
                        <div class="listing-content">
                            <div class="listing-header">
                                <h3 class="listing-title">${listing.title}</h3>
                                <div class="listing-rating">
                                    <span>${listing.rating}</span>
                                    <i class="fas fa-star"></i>
                                </div>
                            </div>
                            <div class="listing-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${listing.location}</span>
                            </div>
                            <div class="listing-features">
                                ${listing.features.map(feature =>
                `<span class="badge badge-outline">${feature}</span>`
            ).join('')}
                            </div>
                            <div class="listing-footer">
                                <div class="listing-price">
                                    <span>${listing.points} P</span>
                                </div>
                                <div class="listing-host">
                                    <div class="avatar">
                                        <img src="${listing.host.image}" alt="${listing.host.name}">
                                    </div>
                                    <span>${listing.host.name}</span>
                                </div>
                            </div>
                        </div>
                    </a>
                `;

            container.appendChild(card);
        });
    }

    // 디바운스 함수
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this;
            const args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                func.apply(context, args);
            }, wait);
        };
    }
</script>
</body>
</html>